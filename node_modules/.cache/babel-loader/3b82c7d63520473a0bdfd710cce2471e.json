{"ast":null,"code":"var _jsxFileName = \"/Volumes/BIG HD/github/Video-Meeting/src/Video.js\";\nimport React, { Component } from 'react';\nimport io from 'socket.io-client';\nimport faker from \"faker\";\nimport { IconButton, Badge, Input, Button } from '@material-ui/core';\nimport VideocamIcon from '@material-ui/icons/Videocam';\nimport VideocamOffIcon from '@material-ui/icons/VideocamOff';\nimport MicIcon from '@material-ui/icons/Mic';\nimport MicOffIcon from '@material-ui/icons/MicOff';\nimport ScreenShareIcon from '@material-ui/icons/ScreenShare';\nimport StopScreenShareIcon from '@material-ui/icons/StopScreenShare';\nimport CallEndIcon from '@material-ui/icons/CallEnd';\nimport ChatIcon from '@material-ui/icons/Chat';\nimport { message } from 'antd';\nimport 'antd/dist/antd.css';\nimport { Row } from 'reactstrap';\nimport Modal from 'react-bootstrap/Modal';\nimport 'bootstrap/dist/css/bootstrap.css';\nimport \"./Video.css\";\nconst server_url = process.env.NODE_ENV === 'production' ? 'https://video.sebastienbiollo.com' : \"http://localhost:4001\";\nvar connections = {};\nconst peerConnectionConfig = {\n  'iceServers': [// { 'urls': 'stun:stun.services.mozilla.com' },\n  {\n    'urls': 'stun:stun.l.google.com:19302'\n  }]\n};\nvar socket = null;\nvar socketId = null;\nvar elms = 0;\n\nclass Video extends Component {\n  constructor(props) {\n    super(props);\n\n    this.getPermissions = async () => {\n      try {\n        await navigator.mediaDevices.getUserMedia({\n          video: true\n        }).then(() => this.videoAvailable = true).catch(() => this.videoAvailable = false);\n        await navigator.mediaDevices.getUserMedia({\n          audio: true\n        }).then(() => this.audioAvailable = true).catch(() => this.audioAvailable = false);\n\n        if (navigator.mediaDevices.getDisplayMedia) {\n          this.setState({\n            screenAvailable: true\n          });\n        } else {\n          this.setState({\n            screenAvailable: false\n          });\n        }\n\n        if (this.videoAvailable || this.audioAvailable) {\n          navigator.mediaDevices.getUserMedia({\n            video: this.videoAvailable,\n            audio: this.audioAvailable\n          }).then(stream => {\n            window.localStream = stream;\n            this.localVideoref.current.srcObject = stream;\n          }).then(stream => {}).catch(e => console.log(e));\n        }\n      } catch (e) {\n        console.log(e);\n      }\n    };\n\n    this.getMedia = () => {\n      this.setState({\n        video: this.videoAvailable,\n        audio: this.audioAvailable\n      }, () => {\n        this.getUserMedia();\n        this.connectToSocketServer();\n      });\n    };\n\n    this.getUserMedia = () => {\n      if (this.state.video && this.videoAvailable || this.state.audio && this.audioAvailable) {\n        navigator.mediaDevices.getUserMedia({\n          video: this.state.video,\n          audio: this.state.audio\n        }).then(this.getUserMediaSuccess).then(stream => {}).catch(e => console.log(e));\n      } else {\n        try {\n          let tracks = this.localVideoref.current.srcObject.getTracks();\n          tracks.forEach(track => track.stop());\n        } catch (e) {}\n      }\n    };\n\n    this.getUserMediaSuccess = stream => {\n      try {\n        window.localStream.getTracks().forEach(track => track.stop());\n      } catch (e) {\n        console.log(e);\n      }\n\n      window.localStream = stream;\n      this.localVideoref.current.srcObject = stream;\n\n      for (let id in connections) {\n        if (id === socketId) continue;\n        connections[id].addStream(window.localStream);\n        connections[id].createOffer().then(description => {\n          connections[id].setLocalDescription(description).then(() => {\n            socket.emit('signal', id, JSON.stringify({\n              'sdp': connections[id].localDescription\n            }));\n          }).catch(e => console.log(e));\n        });\n      }\n\n      stream.getTracks().forEach(track => track.onended = () => {\n        this.setState({\n          video: false,\n          audio: false\n        }, () => {\n          try {\n            let tracks = this.localVideoref.current.srcObject.getTracks();\n            tracks.forEach(track => track.stop());\n          } catch (e) {\n            console.log(e);\n          }\n\n          let blackSilence = (...args) => new MediaStream([this.black(...args), this.silence()]);\n\n          window.localStream = blackSilence();\n          this.localVideoref.current.srcObject = window.localStream;\n\n          for (let id in connections) {\n            connections[id].addStream(window.localStream);\n            connections[id].createOffer().then(description => {\n              connections[id].setLocalDescription(description).then(() => {\n                socket.emit('signal', id, JSON.stringify({\n                  'sdp': connections[id].localDescription\n                }));\n              }).catch(e => console.log(e));\n            });\n          }\n        });\n      });\n    };\n\n    this.getDislayMedia = () => {\n      if (this.state.screen) {\n        if (navigator.mediaDevices.getDisplayMedia) {\n          navigator.mediaDevices.getDisplayMedia({\n            video: true,\n            audio: true\n          }).then(this.getDislayMediaSuccess).then(stream => {}).catch(e => console.log(e));\n        }\n      }\n    };\n\n    this.getDislayMediaSuccess = stream => {\n      try {\n        window.localStream.getTracks().forEach(track => track.stop());\n      } catch (e) {\n        console.log(e);\n      }\n\n      window.localStream = stream;\n      this.localVideoref.current.srcObject = stream;\n\n      for (let id in connections) {\n        if (id === socketId) continue;\n        connections[id].addStream(window.localStream);\n        connections[id].createOffer().then(description => {\n          connections[id].setLocalDescription(description).then(() => {\n            socket.emit('signal', id, JSON.stringify({\n              'sdp': connections[id].localDescription\n            }));\n          }).catch(e => console.log(e));\n        });\n      }\n\n      stream.getTracks().forEach(track => track.onended = () => {\n        this.setState({\n          screen: false\n        }, () => {\n          try {\n            let tracks = this.localVideoref.current.srcObject.getTracks();\n            tracks.forEach(track => track.stop());\n          } catch (e) {\n            console.log(e);\n          }\n\n          let blackSilence = (...args) => new MediaStream([this.black(...args), this.silence()]);\n\n          window.localStream = blackSilence();\n          this.localVideoref.current.srcObject = window.localStream;\n          this.getUserMedia();\n        });\n      });\n    };\n\n    this.gotMessageFromServer = (fromId, message) => {\n      var signal = JSON.parse(message);\n\n      if (fromId !== socketId) {\n        if (signal.sdp) {\n          connections[fromId].setRemoteDescription(new RTCSessionDescription(signal.sdp)).then(() => {\n            if (signal.sdp.type === 'offer') {\n              connections[fromId].createAnswer().then(description => {\n                connections[fromId].setLocalDescription(description).then(() => {\n                  socket.emit('signal', fromId, JSON.stringify({\n                    'sdp': connections[fromId].localDescription\n                  }));\n                }).catch(e => console.log(e));\n              }).catch(e => console.log(e));\n            }\n          }).catch(e => console.log(e));\n        }\n\n        if (signal.ice) {\n          connections[fromId].addIceCandidate(new RTCIceCandidate(signal.ice)).catch(e => console.log(e));\n        }\n      }\n    };\n\n    this.changeCssVideos = main => {\n      let widthMain = main.offsetWidth;\n      let minWidth = \"30%\";\n\n      if (widthMain * 30 / 100 < 300) {\n        minWidth = \"300px\";\n      }\n\n      let minHeight = \"40%\";\n      let height = String(100 / elms) + \"%\";\n      let width = \"\";\n\n      if (elms === 0 || elms === 1) {\n        width = \"100%\";\n        height = \"100%\";\n      } else if (elms === 2) {\n        width = \"45%\";\n        height = \"100%\";\n      } else if (elms === 3 || elms === 4) {\n        width = \"35%\";\n        height = \"50%\";\n      } else {\n        width = String(100 / elms) + \"%\";\n      }\n\n      let videos = main.querySelectorAll(\"video\");\n\n      for (let a = 0; a < videos.length; ++a) {\n        videos[a].style.minWidth = minWidth;\n        videos[a].style.minHeight = minHeight;\n        videos[a].style.setProperty(\"width\", width);\n        videos[a].style.setProperty(\"height\", height);\n      }\n\n      return {\n        minWidth,\n        minHeight,\n        width,\n        height\n      };\n    };\n\n    this.connectToSocketServer = () => {\n      socket = io.connect(server_url, {\n        secure: true\n      });\n      socket.on('signal', this.gotMessageFromServer);\n      socket.on('connect', () => {\n        socket.emit('join-call', window.location.href);\n        socketId = socket.id;\n        socket.on('chat-message', this.addMessage);\n        socket.on('user-left', id => {\n          let video = document.querySelector(`[data-socket=\"${id}\"]`);\n\n          if (video !== null) {\n            elms--;\n            video.parentNode.removeChild(video);\n            let main = document.getElementById('main');\n            this.changeCssVideos(main);\n          }\n        });\n        socket.on('user-joined', (id, clients) => {\n          clients.forEach(socketListId => {\n            connections[socketListId] = new RTCPeerConnection(peerConnectionConfig); // Wait for their ice candidate       \n\n            connections[socketListId].onicecandidate = function (event) {\n              if (event.candidate != null) {\n                socket.emit('signal', socketListId, JSON.stringify({\n                  'ice': event.candidate\n                }));\n              }\n            }; // Wait for their video stream\n\n\n            connections[socketListId].onaddstream = event => {\n              // TODO mute button, full screen button\n              var searchVidep = document.querySelector(`[data-socket=\"${socketListId}\"]`);\n\n              if (searchVidep !== null) {\n                // if i don't do this check it make an empyt square\n                searchVidep.srcObject = event.stream;\n              } else {\n                elms = clients.length;\n                let main = document.getElementById('main');\n                let cssMesure = this.changeCssVideos(main);\n                let video = document.createElement('video');\n                let css = {\n                  minWidth: cssMesure.minWidth,\n                  minHeight: cssMesure.minHeight,\n                  maxHeight: \"100%\",\n                  margin: \"10px\",\n                  borderStyle: \"solid\",\n                  borderColor: \"#bdbdbd\",\n                  objectFit: \"fill\"\n                };\n\n                for (let i in css) video.style[i] = css[i];\n\n                video.style.setProperty(\"width\", cssMesure.width);\n                video.style.setProperty(\"height\", cssMesure.height);\n                video.setAttribute('data-socket', socketListId);\n                video.srcObject = event.stream;\n                video.autoplay = true;\n                video.playsinline = true;\n                main.appendChild(video);\n              }\n            }; // Add the local video stream\n\n\n            if (window.localStream !== undefined && window.localStream !== null) {\n              connections[socketListId].addStream(window.localStream);\n            } else {\n              let blackSilence = (...args) => new MediaStream([this.black(...args), this.silence()]);\n\n              window.localStream = blackSilence();\n              connections[socketListId].addStream(window.localStream);\n            }\n          });\n\n          if (id === socketId) {\n            for (let id2 in connections) {\n              if (id2 === socketId) continue;\n\n              try {\n                connections[id2].addStream(window.localStream);\n              } catch (e) {}\n\n              connections[id2].createOffer().then(description => {\n                connections[id2].setLocalDescription(description).then(() => {\n                  socket.emit('signal', id2, JSON.stringify({\n                    'sdp': connections[id2].localDescription\n                  }));\n                }).catch(e => console.log(e));\n              });\n            }\n          }\n        });\n      });\n    };\n\n    this.silence = () => {\n      let ctx = new AudioContext();\n      let oscillator = ctx.createOscillator();\n      let dst = oscillator.connect(ctx.createMediaStreamDestination());\n      oscillator.start();\n      ctx.resume();\n      return Object.assign(dst.stream.getAudioTracks()[0], {\n        enabled: false\n      });\n    };\n\n    this.black = ({\n      width = 640,\n      height = 480\n    } = {}) => {\n      let canvas = Object.assign(document.createElement(\"canvas\"), {\n        width,\n        height\n      });\n      canvas.getContext('2d').fillRect(0, 0, width, height);\n      let stream = canvas.captureStream();\n      return Object.assign(stream.getVideoTracks()[0], {\n        enabled: false\n      });\n    };\n\n    this.handleVideo = () => this.setState({\n      video: !this.state.video\n    }, () => this.getUserMedia());\n\n    this.handleAudio = () => this.setState({\n      audio: !this.state.audio\n    }, () => this.getUserMedia());\n\n    this.handleScreen = () => this.setState({\n      screen: !this.state.screen\n    }, () => this.getDislayMedia());\n\n    this.handleEndCall = () => {\n      try {\n        let tracks = this.localVideoref.current.srcObject.getTracks();\n        tracks.forEach(track => track.stop());\n      } catch (e) {}\n\n      window.location.href = \"/\";\n    };\n\n    this.openChat = () => this.setState({\n      showModal: true,\n      newmessages: 0\n    });\n\n    this.closeChat = () => this.setState({\n      showModal: false\n    });\n\n    this.handleMessage = e => this.setState({\n      message: e.target.value\n    });\n\n    this.addMessage = (data, sender, socketIdSender) => {\n      this.setState(prevState => ({\n        messages: [...prevState.messages, {\n          \"sender\": sender,\n          \"data\": data\n        }]\n      }));\n\n      if (socketIdSender !== socketId) {\n        this.setState({\n          newmessages: this.state.newmessages + 1\n        });\n      }\n    };\n\n    this.handleUsername = e => this.setState({\n      username: e.target.value\n    });\n\n    this.sendMessage = () => {\n      socket.emit('chat-message', this.state.message, this.state.username);\n      this.setState({\n        message: \"\",\n        sender: this.state.username\n      });\n    };\n\n    this.copyUrl = () => {\n      let text = window.location.href;\n\n      if (!navigator.clipboard) {\n        let textArea = document.createElement(\"textarea\");\n        textArea.value = text;\n        document.body.appendChild(textArea);\n        textArea.focus();\n        textArea.select();\n\n        try {\n          document.execCommand('copy');\n          message.success(\"Link copied to clipboard!\");\n        } catch (err) {\n          message.error(\"Failed to copy\");\n        }\n\n        document.body.removeChild(textArea);\n        return;\n      }\n\n      navigator.clipboard.writeText(text).then(function () {\n        message.success(\"Link copied to clipboard!\");\n      }, () => {\n        message.error(\"Failed to copy\");\n      });\n    };\n\n    this.connect = () => this.setState({\n      askForUsername: false\n    }, () => this.getMedia());\n\n    this.isChrome = function () {\n      let userAgent = (navigator && (navigator.userAgent || '')).toLowerCase();\n      let vendor = (navigator && (navigator.vendor || '')).toLowerCase();\n      let matchChrome = /google inc/.test(vendor) ? userAgent.match(/(?:chrome|crios)\\/(\\d+)/) : null; // let matchFirefox = userAgent.match(/(?:firefox|fxios)\\/(\\d+)/)\n      // return matchChrome !== null || matchFirefox !== null\n\n      return matchChrome !== null;\n    };\n\n    this.localVideoref = React.createRef();\n    this.videoAvailable = false;\n    this.audioAvailable = false;\n    this.state = {\n      video: false,\n      audio: false,\n      screen: false,\n      showModal: false,\n      screenAvailable: false,\n      messages: [],\n      message: \"\",\n      newmessages: 0,\n      askForUsername: true,\n      username: faker.internet.userName()\n    };\n    connections = {};\n    this.getPermissions();\n  }\n\n  render() {\n    if (this.isChrome() === false) {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          background: \"white\",\n          width: \"30%\",\n          height: \"auto\",\n          padding: \"20px\",\n          minWidth: \"400px\",\n          textAlign: \"center\",\n          margin: \"auto\",\n          marginTop: \"50px\",\n          justifyContent: \"center\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 448,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"h1\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 450,\n          columnNumber: 6\n        }\n      }, \"Sorry, this works only with Google Chrome\"));\n    }\n\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 455,\n        columnNumber: 4\n      }\n    }, this.state.askForUsername === true ? /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 457,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        background: \"white\",\n        width: \"30%\",\n        height: \"auto\",\n        padding: \"20px\",\n        minWidth: \"400px\",\n        textAlign: \"center\",\n        margin: \"auto\",\n        marginTop: \"50px\",\n        justifyContent: \"center\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 458,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      style: {\n        margin: 0,\n        fontWeight: \"bold\",\n        paddingRight: \"50px\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 460,\n        columnNumber: 8\n      }\n    }, \"Set your username\"), /*#__PURE__*/React.createElement(Input, {\n      placeholder: \"Username\",\n      value: this.state.username,\n      onChange: e => this.handleUsername(e),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 461,\n        columnNumber: 8\n      }\n    }), /*#__PURE__*/React.createElement(Button, {\n      variant: \"contained\",\n      color: \"primary\",\n      onClick: this.connect,\n      style: {\n        margin: \"20px\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 462,\n        columnNumber: 8\n      }\n    }, \"Connect\")), /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        justifyContent: \"center\",\n        textAlign: \"center\",\n        paddingTop: \"40px\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 465,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"video\", {\n      id: \"my-video\",\n      ref: this.localVideoref,\n      autoPlay: true,\n      muted: true,\n      style: {\n        borderStyle: \"solid\",\n        borderColor: \"#bdbdbd\",\n        objectFit: \"fill\",\n        width: \"60%\",\n        height: \"30%\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 466,\n        columnNumber: 8\n      }\n    }))) : /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 471,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"btn-down\",\n      style: {\n        backgroundColor: \"whitesmoke\",\n        color: \"whitesmoke\",\n        textAlign: \"center\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 472,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(IconButton, {\n      style: {\n        color: \"#424242\"\n      },\n      onClick: this.handleVideo,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 473,\n        columnNumber: 8\n      }\n    }, this.state.video === true ? /*#__PURE__*/React.createElement(VideocamIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 474,\n        columnNumber: 40\n      }\n    }) : /*#__PURE__*/React.createElement(VideocamOffIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 474,\n        columnNumber: 59\n      }\n    })), /*#__PURE__*/React.createElement(IconButton, {\n      style: {\n        color: \"#f44336\"\n      },\n      onClick: this.handleEndCall,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 477,\n        columnNumber: 8\n      }\n    }, /*#__PURE__*/React.createElement(CallEndIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 478,\n        columnNumber: 9\n      }\n    })), /*#__PURE__*/React.createElement(IconButton, {\n      style: {\n        color: \"#424242\"\n      },\n      onClick: this.handleAudio,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 481,\n        columnNumber: 8\n      }\n    }, this.state.audio === true ? /*#__PURE__*/React.createElement(MicIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 482,\n        columnNumber: 38\n      }\n    }) : /*#__PURE__*/React.createElement(MicOffIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 482,\n        columnNumber: 52\n      }\n    })), this.state.screenAvailable === true ? /*#__PURE__*/React.createElement(IconButton, {\n      style: {\n        color: \"#424242\"\n      },\n      onClick: this.handleScreen,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 486,\n        columnNumber: 9\n      }\n    }, this.state.screen === true ? /*#__PURE__*/React.createElement(ScreenShareIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 487,\n        columnNumber: 40\n      }\n    }) : /*#__PURE__*/React.createElement(StopScreenShareIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 487,\n        columnNumber: 62\n      }\n    })) : null, /*#__PURE__*/React.createElement(Badge, {\n      badgeContent: this.state.newmessages,\n      max: 999,\n      color: \"secondary\",\n      onClick: this.openChat,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 491,\n        columnNumber: 8\n      }\n    }, /*#__PURE__*/React.createElement(IconButton, {\n      style: {\n        color: \"#424242\"\n      },\n      onClick: this.openChat,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 492,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(ChatIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 493,\n        columnNumber: 10\n      }\n    })))), /*#__PURE__*/React.createElement(Modal, {\n      show: this.state.showModal,\n      onHide: this.closeChat,\n      style: {\n        zIndex: \"999999\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 498,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Modal.Header, {\n      closeButton: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 499,\n        columnNumber: 8\n      }\n    }, /*#__PURE__*/React.createElement(Modal.Title, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 500,\n        columnNumber: 9\n      }\n    }, \"Chat Room\")), /*#__PURE__*/React.createElement(Modal.Body, {\n      style: {\n        overflow: \"auto\",\n        overflowY: \"auto\",\n        height: \"400px\",\n        textAlign: \"left\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 502,\n        columnNumber: 8\n      }\n    }, this.state.messages.length > 0 ? this.state.messages.map((item, index) => /*#__PURE__*/React.createElement(\"div\", {\n      key: index,\n      style: {\n        textAlign: \"left\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 504,\n        columnNumber: 10\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      style: {\n        wordBreak: \"break-all\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 505,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 505,\n        columnNumber: 49\n      }\n    }, item.sender), \": \", item.data))) : /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 507,\n        columnNumber: 14\n      }\n    }, \"No message yet\")), /*#__PURE__*/React.createElement(Modal.Footer, {\n      className: \"div-send-msg\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 509,\n        columnNumber: 8\n      }\n    }, /*#__PURE__*/React.createElement(Input, {\n      placeholder: \"Message\",\n      value: this.state.message,\n      onChange: e => this.handleMessage(e),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 510,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(Button, {\n      variant: \"contained\",\n      color: \"primary\",\n      onClick: this.sendMessage,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 511,\n        columnNumber: 9\n      }\n    }, \"Send\"))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 515,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        paddingTop: \"20px\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 516,\n        columnNumber: 8\n      }\n    }, /*#__PURE__*/React.createElement(Input, {\n      value: window.location.href,\n      disable: \"true\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 517,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(Button, {\n      style: {\n        backgroundColor: \"#3f51b5\",\n        color: \"whitesmoke\",\n        marginLeft: \"20px\",\n        marginTop: \"10px\",\n        width: \"120px\",\n        fontSize: \"10px\"\n      },\n      onClick: this.copyUrl,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 518,\n        columnNumber: 9\n      }\n    }, \"Copy invite link\")), /*#__PURE__*/React.createElement(Row, {\n      id: \"main\",\n      className: \"flex-container\",\n      style: {\n        margin: 0,\n        padding: 0\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 523,\n        columnNumber: 8\n      }\n    }, /*#__PURE__*/React.createElement(\"video\", {\n      id: \"my-video\",\n      ref: this.localVideoref,\n      autoPlay: true,\n      muted: true,\n      style: {\n        borderStyle: \"solid\",\n        borderColor: \"#bdbdbd\",\n        margin: \"10px\",\n        objectFit: \"fill\",\n        width: \"100%\",\n        height: \"100%\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 524,\n        columnNumber: 9\n      }\n    })))));\n  }\n\n}\n\nexport default Video;","map":{"version":3,"sources":["/Volumes/BIG HD/github/Video-Meeting/src/Video.js"],"names":["React","Component","io","faker","IconButton","Badge","Input","Button","VideocamIcon","VideocamOffIcon","MicIcon","MicOffIcon","ScreenShareIcon","StopScreenShareIcon","CallEndIcon","ChatIcon","message","Row","Modal","server_url","process","env","NODE_ENV","connections","peerConnectionConfig","socket","socketId","elms","Video","constructor","props","getPermissions","navigator","mediaDevices","getUserMedia","video","then","videoAvailable","catch","audio","audioAvailable","getDisplayMedia","setState","screenAvailable","stream","window","localStream","localVideoref","current","srcObject","e","console","log","getMedia","connectToSocketServer","state","getUserMediaSuccess","tracks","getTracks","forEach","track","stop","id","addStream","createOffer","description","setLocalDescription","emit","JSON","stringify","localDescription","onended","blackSilence","args","MediaStream","black","silence","getDislayMedia","screen","getDislayMediaSuccess","gotMessageFromServer","fromId","signal","parse","sdp","setRemoteDescription","RTCSessionDescription","type","createAnswer","ice","addIceCandidate","RTCIceCandidate","changeCssVideos","main","widthMain","offsetWidth","minWidth","minHeight","height","String","width","videos","querySelectorAll","a","length","style","setProperty","connect","secure","on","location","href","addMessage","document","querySelector","parentNode","removeChild","getElementById","clients","socketListId","RTCPeerConnection","onicecandidate","event","candidate","onaddstream","searchVidep","cssMesure","createElement","css","maxHeight","margin","borderStyle","borderColor","objectFit","i","setAttribute","autoplay","playsinline","appendChild","undefined","id2","ctx","AudioContext","oscillator","createOscillator","dst","createMediaStreamDestination","start","resume","Object","assign","getAudioTracks","enabled","canvas","getContext","fillRect","captureStream","getVideoTracks","handleVideo","handleAudio","handleScreen","handleEndCall","openChat","showModal","newmessages","closeChat","handleMessage","target","value","data","sender","socketIdSender","prevState","messages","handleUsername","username","sendMessage","copyUrl","text","clipboard","textArea","body","focus","select","execCommand","success","err","error","writeText","askForUsername","isChrome","userAgent","toLowerCase","vendor","matchChrome","test","match","createRef","internet","userName","render","background","padding","textAlign","marginTop","justifyContent","fontWeight","paddingRight","paddingTop","backgroundColor","color","zIndex","overflow","overflowY","map","item","index","wordBreak","marginLeft","fontSize"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport io from 'socket.io-client'\nimport faker from \"faker\"\n\nimport {IconButton, Badge, Input, Button} from '@material-ui/core'\nimport VideocamIcon from '@material-ui/icons/Videocam'\nimport VideocamOffIcon from '@material-ui/icons/VideocamOff'\nimport MicIcon from '@material-ui/icons/Mic'\nimport MicOffIcon from '@material-ui/icons/MicOff'\nimport ScreenShareIcon from '@material-ui/icons/ScreenShare'\nimport StopScreenShareIcon from '@material-ui/icons/StopScreenShare'\nimport CallEndIcon from '@material-ui/icons/CallEnd'\nimport ChatIcon from '@material-ui/icons/Chat'\n\nimport { message } from 'antd'\nimport 'antd/dist/antd.css'\n\nimport { Row } from 'reactstrap'\nimport Modal from 'react-bootstrap/Modal'\nimport 'bootstrap/dist/css/bootstrap.css'\nimport \"./Video.css\"\n\nconst server_url = process.env.NODE_ENV === 'production' ? 'https://video.sebastienbiollo.com' : \"http://localhost:4001\"\n\nvar connections = {}\nconst peerConnectionConfig = {\n\t'iceServers': [\n\t\t// { 'urls': 'stun:stun.services.mozilla.com' },\n\t\t{ 'urls': 'stun:stun.l.google.com:19302' },\n\t]\n}\nvar socket = null\nvar socketId = null\nvar elms = 0\n\nclass Video extends Component {\n\tconstructor(props) {\n\t\tsuper(props)\n\n\t\tthis.localVideoref = React.createRef()\n\n\t\tthis.videoAvailable = false\n\t\tthis.audioAvailable = false\n\n\t\tthis.state = {\n\t\t\tvideo: false,\n\t\t\taudio: false,\n\t\t\tscreen: false,\n\t\t\tshowModal: false,\n\t\t\tscreenAvailable: false,\n\t\t\tmessages: [],\n\t\t\tmessage: \"\",\n\t\t\tnewmessages: 0,\n\t\t\taskForUsername: true,\n\t\t\tusername: faker.internet.userName(),\n\t\t}\n\t\tconnections = {}\n\n\t\tthis.getPermissions()\n\t}\n\n\tgetPermissions = async () => {\n\t\ttry{\n\t\t\tawait navigator.mediaDevices.getUserMedia({ video: true })\n\t\t\t\t.then(() => this.videoAvailable = true)\n\t\t\t\t.catch(() => this.videoAvailable = false)\n\n\t\t\tawait navigator.mediaDevices.getUserMedia({ audio: true })\n\t\t\t\t.then(() => this.audioAvailable = true)\n\t\t\t\t.catch(() => this.audioAvailable = false)\n\n\t\t\tif (navigator.mediaDevices.getDisplayMedia) {\n\t\t\t\tthis.setState({ screenAvailable: true })\n\t\t\t} else {\n\t\t\t\tthis.setState({ screenAvailable: false })\n\t\t\t}\n\n\t\t\tif (this.videoAvailable || this.audioAvailable) {\n\t\t\t\tnavigator.mediaDevices.getUserMedia({ video: this.videoAvailable, audio: this.audioAvailable })\n\t\t\t\t\t.then((stream) => {\n\t\t\t\t\t\twindow.localStream = stream\n\t\t\t\t\t\tthis.localVideoref.current.srcObject = stream\n\t\t\t\t\t})\n\t\t\t\t\t.then((stream) => {})\n\t\t\t\t\t.catch((e) => console.log(e))\n\t\t\t}\n\t\t} catch(e) { console.log(e) }\n\t}\n\n\tgetMedia = () => {\n\t\tthis.setState({\n\t\t\tvideo: this.videoAvailable,\n\t\t\taudio: this.audioAvailable\n\t\t}, () => {\n\t\t\tthis.getUserMedia()\n\t\t\tthis.connectToSocketServer()\n\t\t})\n\t}\n\n\tgetUserMedia = () => {\n\t\tif ((this.state.video && this.videoAvailable) || (this.state.audio && this.audioAvailable)) {\n\t\t\tnavigator.mediaDevices.getUserMedia({ video: this.state.video, audio: this.state.audio })\n\t\t\t\t.then(this.getUserMediaSuccess)\n\t\t\t\t.then((stream) => {})\n\t\t\t\t.catch((e) => console.log(e))\n\t\t} else {\n\t\t\ttry {\n\t\t\t\tlet tracks = this.localVideoref.current.srcObject.getTracks()\n\t\t\t\ttracks.forEach(track => track.stop())\n\t\t\t} catch (e) {}\n\t\t}\n\t}\n\n\tgetUserMediaSuccess = (stream) => {\n\t\ttry {\n\t\t\twindow.localStream.getTracks().forEach(track => track.stop())\n\t\t} catch(e) { console.log(e) }\n\n\t\twindow.localStream = stream\n\t\tthis.localVideoref.current.srcObject = stream\n\n\t\tfor (let id in connections) {\n\t\t\tif (id === socketId) continue\n\n\t\t\tconnections[id].addStream(window.localStream)\n\n\t\t\tconnections[id].createOffer().then((description) => {\n\t\t\t\tconnections[id].setLocalDescription(description)\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tsocket.emit('signal', id, JSON.stringify({ 'sdp': connections[id].localDescription }))\n\t\t\t\t\t})\n\t\t\t\t\t.catch(e => console.log(e))\n\t\t\t})\n\t\t}\n\n\t\tstream.getTracks().forEach(track => track.onended = () => {\n\t\t\tthis.setState({\n\t\t\t\tvideo: false,\n\t\t\t\taudio: false,\n\t\t\t}, () => {\n\t\t\t\ttry {\n\t\t\t\t\tlet tracks = this.localVideoref.current.srcObject.getTracks()\n\t\t\t\t\ttracks.forEach(track => track.stop())\n\t\t\t\t} catch(e) { console.log(e) }\n\n\t\t\t\tlet blackSilence = (...args) => new MediaStream([this.black(...args), this.silence()])\n\t\t\t\twindow.localStream = blackSilence()\n\t\t\t\tthis.localVideoref.current.srcObject = window.localStream\n\n\t\t\t\tfor (let id in connections) {\n\t\t\t\t\tconnections[id].addStream(window.localStream)\n\n\t\t\t\t\tconnections[id].createOffer().then((description) => {\n\t\t\t\t\t\tconnections[id].setLocalDescription(description)\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tsocket.emit('signal', id, JSON.stringify({ 'sdp': connections[id].localDescription }))\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(e => console.log(e))\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t})\n\t}\n\n\tgetDislayMedia = () => {\n\t\tif (this.state.screen) {\n\t\t\tif (navigator.mediaDevices.getDisplayMedia) {\n\t\t\t\tnavigator.mediaDevices.getDisplayMedia({ video: true, audio: true })\n\t\t\t\t\t.then(this.getDislayMediaSuccess)\n\t\t\t\t\t.then((stream) => {})\n\t\t\t\t\t.catch((e) => console.log(e))\n\t\t\t}\n\t\t}\n\t}\n\n\tgetDislayMediaSuccess = (stream) => {\n\t\ttry {\n\t\t\twindow.localStream.getTracks().forEach(track => track.stop())\n\t\t} catch(e) { console.log(e) }\n\n\t\twindow.localStream = stream\n\t\tthis.localVideoref.current.srcObject = stream\n\n\t\tfor (let id in connections) {\n\t\t\tif (id === socketId) continue\n\n\t\t\tconnections[id].addStream(window.localStream)\n\n\t\t\tconnections[id].createOffer().then((description) => {\n\t\t\t\tconnections[id].setLocalDescription(description)\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tsocket.emit('signal', id, JSON.stringify({ 'sdp': connections[id].localDescription }))\n\t\t\t\t\t})\n\t\t\t\t\t.catch(e => console.log(e))\n\t\t\t})\n\t\t}\n\n\t\tstream.getTracks().forEach(track => track.onended = () => {\n\t\t\tthis.setState({\n\t\t\t\tscreen: false,\n\t\t\t}, () => {\n\t\t\t\ttry {\n\t\t\t\t\tlet tracks = this.localVideoref.current.srcObject.getTracks()\n\t\t\t\t\ttracks.forEach(track => track.stop())\n\t\t\t\t} catch(e) { console.log(e) }\n\n\t\t\t\tlet blackSilence = (...args) => new MediaStream([this.black(...args), this.silence()])\n\t\t\t\twindow.localStream = blackSilence()\n\t\t\t\tthis.localVideoref.current.srcObject = window.localStream\n\n\t\t\t\tthis.getUserMedia()\n\t\t\t})\n\t\t})\n\t}\n\n\tgotMessageFromServer = (fromId, message) => {\n\t\tvar signal = JSON.parse(message)\n\n\t\tif (fromId !== socketId) {\n\t\t\tif (signal.sdp) {\n\t\t\t\tconnections[fromId].setRemoteDescription(new RTCSessionDescription(signal.sdp)).then(() => {\n\t\t\t\t\tif (signal.sdp.type === 'offer') {\n\t\t\t\t\t\tconnections[fromId].createAnswer().then((description) => {\n\t\t\t\t\t\t\tconnections[fromId].setLocalDescription(description).then(() => {\n\t\t\t\t\t\t\t\tsocket.emit('signal', fromId, JSON.stringify({ 'sdp': connections[fromId].localDescription }))\n\t\t\t\t\t\t\t}).catch(e => console.log(e))\n\t\t\t\t\t\t}).catch(e => console.log(e))\n\t\t\t\t\t}\n\t\t\t\t}).catch(e => console.log(e))\n\t\t\t}\n\n\t\t\tif (signal.ice) {\n\t\t\t\tconnections[fromId].addIceCandidate(new RTCIceCandidate(signal.ice)).catch(e => console.log(e))\n\t\t\t}\n\t\t}\n\t}\n\n\tchangeCssVideos = (main) => {\n\t\tlet widthMain = main.offsetWidth\n\t\tlet minWidth = \"30%\"\n\t\tif ((widthMain * 30 / 100) < 300) {\n\t\t\tminWidth = \"300px\"\n\t\t}\n\t\tlet minHeight = \"40%\"\n\n\t\tlet height = String(100 / elms) + \"%\"\n\t\tlet width = \"\"\n\t\tif(elms === 0 || elms === 1) {\n\t\t\twidth = \"100%\"\n\t\t\theight = \"100%\"\n\t\t} else if (elms === 2) {\n\t\t\twidth = \"45%\"\n\t\t\theight = \"100%\"\n\t\t} else if (elms === 3 || elms === 4) {\n\t\t\twidth = \"35%\"\n\t\t\theight = \"50%\"\n\t\t} else {\n\t\t\twidth = String(100 / elms) + \"%\"\n\t\t}\n\n\t\tlet videos = main.querySelectorAll(\"video\")\n\t\tfor (let a = 0; a < videos.length; ++a) {\n\t\t\tvideos[a].style.minWidth = minWidth\n\t\t\tvideos[a].style.minHeight = minHeight\n\t\t\tvideos[a].style.setProperty(\"width\", width)\n\t\t\tvideos[a].style.setProperty(\"height\", height)\n\t\t}\n\n\t\treturn {minWidth, minHeight, width, height}\n\t}\n\n\tconnectToSocketServer = () => {\n\t\tsocket = io.connect(server_url, { secure: true })\n\n\t\tsocket.on('signal', this.gotMessageFromServer)\n\n\t\tsocket.on('connect', () => {\n\t\t\tsocket.emit('join-call', window.location.href)\n\t\t\tsocketId = socket.id\n\n\t\t\tsocket.on('chat-message', this.addMessage)\n\n\t\t\tsocket.on('user-left', (id) => {\n\t\t\t\tlet video = document.querySelector(`[data-socket=\"${id}\"]`)\n\t\t\t\tif (video !== null) {\n\t\t\t\t\telms--\n\t\t\t\t\tvideo.parentNode.removeChild(video)\n\n\t\t\t\t\tlet main = document.getElementById('main')\n\t\t\t\t\tthis.changeCssVideos(main)\n\t\t\t\t}\n\t\t\t})\n\n\t\t\tsocket.on('user-joined', (id, clients) => {\n\t\t\t\tclients.forEach((socketListId) => {\n\t\t\t\t\tconnections[socketListId] = new RTCPeerConnection(peerConnectionConfig)\n\t\t\t\t\t// Wait for their ice candidate       \n\t\t\t\t\tconnections[socketListId].onicecandidate = function (event) {\n\t\t\t\t\t\tif (event.candidate != null) {\n\t\t\t\t\t\t\tsocket.emit('signal', socketListId, JSON.stringify({ 'ice': event.candidate }))\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Wait for their video stream\n\t\t\t\t\tconnections[socketListId].onaddstream = (event) => {\n\t\t\t\t\t\t// TODO mute button, full screen button\n\t\t\t\t\t\tvar searchVidep = document.querySelector(`[data-socket=\"${socketListId}\"]`)\n\t\t\t\t\t\tif (searchVidep !== null) { // if i don't do this check it make an empyt square\n\t\t\t\t\t\t\tsearchVidep.srcObject = event.stream\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\telms = clients.length\n\t\t\t\t\t\t\tlet main = document.getElementById('main')\n\t\t\t\t\t\t\tlet cssMesure = this.changeCssVideos(main)\n\n\t\t\t\t\t\t\tlet video = document.createElement('video')\n\n\t\t\t\t\t\t\tlet css = {minWidth: cssMesure.minWidth, minHeight: cssMesure.minHeight, maxHeight: \"100%\", margin: \"10px\",\n\t\t\t\t\t\t\t\tborderStyle: \"solid\", borderColor: \"#bdbdbd\", objectFit: \"fill\"}\n\t\t\t\t\t\t\tfor(let i in css) video.style[i] = css[i]\n\n\t\t\t\t\t\t\tvideo.style.setProperty(\"width\", cssMesure.width)\n\t\t\t\t\t\t\tvideo.style.setProperty(\"height\", cssMesure.height)\n\t\t\t\t\t\t\tvideo.setAttribute('data-socket', socketListId)\n\t\t\t\t\t\t\tvideo.srcObject = event.stream\n\t\t\t\t\t\t\tvideo.autoplay = true\n\t\t\t\t\t\t\tvideo.playsinline = true\n\n\t\t\t\t\t\t\tmain.appendChild(video)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Add the local video stream\n\t\t\t\t\tif (window.localStream !== undefined && window.localStream !== null) {\n\t\t\t\t\t\tconnections[socketListId].addStream(window.localStream)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet blackSilence = (...args) => new MediaStream([this.black(...args), this.silence()])\n\t\t\t\t\t\twindow.localStream = blackSilence()\n\t\t\t\t\t\tconnections[socketListId].addStream(window.localStream)\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tif (id === socketId) {\n\t\t\t\t\tfor (let id2 in connections) {\n\t\t\t\t\t\tif (id2 === socketId) continue\n\t\t\t\t\t\t\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconnections[id2].addStream(window.localStream)\n\t\t\t\t\t\t} catch(e) {}\n\t\t\t\n\t\t\t\t\t\tconnections[id2].createOffer().then((description) => {\n\t\t\t\t\t\t\tconnections[id2].setLocalDescription(description)\n\t\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\t\tsocket.emit('signal', id2, JSON.stringify({ 'sdp': connections[id2].localDescription }))\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.catch(e => console.log(e))\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t})\n\t}\n\n\tsilence = () => {\n\t\tlet ctx = new AudioContext()\n\t\tlet oscillator = ctx.createOscillator()\n\t\tlet dst = oscillator.connect(ctx.createMediaStreamDestination())\n\t\toscillator.start()\n\t\tctx.resume()\n\t\treturn Object.assign(dst.stream.getAudioTracks()[0], { enabled: false })\n\t}\n\tblack = ({ width = 640, height = 480 } = {}) => {\n\t\tlet canvas = Object.assign(document.createElement(\"canvas\"), { width, height })\n\t\tcanvas.getContext('2d').fillRect(0, 0, width, height)\n\t\tlet stream = canvas.captureStream()\n\t\treturn Object.assign(stream.getVideoTracks()[0], { enabled: false })\n\t}\n\n\thandleVideo = () => this.setState({ video: !this.state.video }, () => this.getUserMedia())\n\thandleAudio = () => this.setState({ audio: !this.state.audio }, () => this.getUserMedia())\n\thandleScreen = () => this.setState({ screen: !this.state.screen }, () => this.getDislayMedia())\n\n\thandleEndCall = () => {\n\t\ttry {\n\t\t\tlet tracks = this.localVideoref.current.srcObject.getTracks()\n\t\t\ttracks.forEach(track => track.stop())\n\t\t} catch (e) {}\n\t\twindow.location.href = \"/\"\n\t}\n\n\topenChat = () => this.setState({ showModal: true, newmessages: 0 })\n\tcloseChat = () => this.setState({ showModal: false })\n\thandleMessage = (e) => this.setState({ message: e.target.value })\n\n\taddMessage = (data, sender, socketIdSender) => {\n\t\tthis.setState(prevState => ({\n\t\t\tmessages: [...prevState.messages, { \"sender\": sender, \"data\": data }],\n\t\t}))\n\t\tif (socketIdSender !== socketId) {\n\t\t\tthis.setState({ newmessages: this.state.newmessages + 1 })\n\t\t}\n\t}\n\n\thandleUsername = (e) => this.setState({ username: e.target.value })\n\n\tsendMessage = () => {\n\t\tsocket.emit('chat-message', this.state.message, this.state.username)\n\t\tthis.setState({ message: \"\", sender: this.state.username })\n\t}\n\n\tcopyUrl = () => {\n\t\tlet text = window.location.href\n\t\tif (!navigator.clipboard) {\n\t\t\tlet textArea = document.createElement(\"textarea\")\n\t\t\ttextArea.value = text\n\t\t\tdocument.body.appendChild(textArea)\n\t\t\ttextArea.focus()\n\t\t\ttextArea.select()\n\t\t\ttry {\n\t\t\t\tdocument.execCommand('copy')\n\t\t\t\tmessage.success(\"Link copied to clipboard!\")\n\t\t\t} catch (err) {\n\t\t\t\tmessage.error(\"Failed to copy\")\n\t\t\t}\n\t\t\tdocument.body.removeChild(textArea)\n\t\t\treturn\n\t\t}\n\t\tnavigator.clipboard.writeText(text).then(function () {\n\t\t\tmessage.success(\"Link copied to clipboard!\")\n\t\t}, () => {\n\t\t\tmessage.error(\"Failed to copy\")\n\t\t})\n\t}\n\n\tconnect = () => this.setState({ askForUsername: false }, () => this.getMedia())\n\n\tisChrome = function () {\n\t\tlet userAgent = (navigator && (navigator.userAgent || '')).toLowerCase()\n\t\tlet vendor = (navigator && (navigator.vendor || '')).toLowerCase()\n\t\tlet matchChrome = /google inc/.test(vendor) ? userAgent.match(/(?:chrome|crios)\\/(\\d+)/) : null\n\t\t// let matchFirefox = userAgent.match(/(?:firefox|fxios)\\/(\\d+)/)\n\t\t// return matchChrome !== null || matchFirefox !== null\n\t\treturn matchChrome !== null\n\t}\n\n\trender() {\n\t\tif(this.isChrome() === false){\n\t\t\treturn (\n\t\t\t\t<div style={{background: \"white\", width: \"30%\", height: \"auto\", padding: \"20px\", minWidth: \"400px\",\n\t\t\t\t\t\ttextAlign: \"center\", margin: \"auto\", marginTop: \"50px\", justifyContent: \"center\"}}>\n\t\t\t\t\t<h1>Sorry, this works only with Google Chrome</h1>\n\t\t\t\t</div>\n\t\t\t)\n\t\t}\n\t\treturn (\n\t\t\t<div>\n\t\t\t\t{this.state.askForUsername === true ?\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div style={{background: \"white\", width: \"30%\", height: \"auto\", padding: \"20px\", minWidth: \"400px\",\n\t\t\t\t\t\t\t\ttextAlign: \"center\", margin: \"auto\", marginTop: \"50px\", justifyContent: \"center\"}}>\n\t\t\t\t\t\t\t<p style={{ margin: 0, fontWeight: \"bold\", paddingRight: \"50px\" }}>Set your username</p>\n\t\t\t\t\t\t\t<Input placeholder=\"Username\" value={this.state.username} onChange={e => this.handleUsername(e)} />\n\t\t\t\t\t\t\t<Button variant=\"contained\" color=\"primary\" onClick={this.connect} style={{ margin: \"20px\" }}>Connect</Button>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div style={{ justifyContent: \"center\", textAlign: \"center\", paddingTop: \"40px\" }}>\n\t\t\t\t\t\t\t<video id=\"my-video\" ref={this.localVideoref} autoPlay muted style={{\n\t\t\t\t\t\t\t\tborderStyle: \"solid\",borderColor: \"#bdbdbd\",objectFit: \"fill\",width: \"60%\",height: \"30%\"}}></video>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t:\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div className=\"btn-down\" style={{ backgroundColor: \"whitesmoke\", color: \"whitesmoke\", textAlign: \"center\" }}>\n\t\t\t\t\t\t\t<IconButton style={{ color: \"#424242\" }} onClick={this.handleVideo}>\n\t\t\t\t\t\t\t\t{(this.state.video === true) ? <VideocamIcon /> : <VideocamOffIcon />}\n\t\t\t\t\t\t\t</IconButton>\n\n\t\t\t\t\t\t\t<IconButton style={{ color: \"#f44336\" }} onClick={this.handleEndCall}>\n\t\t\t\t\t\t\t\t<CallEndIcon />\n\t\t\t\t\t\t\t</IconButton>\n\n\t\t\t\t\t\t\t<IconButton style={{ color: \"#424242\" }} onClick={this.handleAudio}>\n\t\t\t\t\t\t\t\t{this.state.audio === true ? <MicIcon /> : <MicOffIcon />}\n\t\t\t\t\t\t\t</IconButton>\n\n\t\t\t\t\t\t\t{this.state.screenAvailable === true ?\n\t\t\t\t\t\t\t\t<IconButton style={{ color: \"#424242\" }} onClick={this.handleScreen}>\n\t\t\t\t\t\t\t\t\t{this.state.screen === true ? <ScreenShareIcon /> : <StopScreenShareIcon />}\n\t\t\t\t\t\t\t\t</IconButton>\n\t\t\t\t\t\t\t\t: null}\n\n\t\t\t\t\t\t\t<Badge badgeContent={this.state.newmessages} max={999} color=\"secondary\" onClick={this.openChat}>\n\t\t\t\t\t\t\t\t<IconButton style={{ color: \"#424242\" }} onClick={this.openChat}>\n\t\t\t\t\t\t\t\t\t<ChatIcon />\n\t\t\t\t\t\t\t\t</IconButton>\n\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<Modal show={this.state.showModal} onHide={this.closeChat} style={{ zIndex: \"999999\" }}>\n\t\t\t\t\t\t\t<Modal.Header closeButton>\n\t\t\t\t\t\t\t\t<Modal.Title>Chat Room</Modal.Title>\n\t\t\t\t\t\t\t</Modal.Header>\n\t\t\t\t\t\t\t<Modal.Body style={{ overflow: \"auto\", overflowY: \"auto\", height: \"400px\", textAlign: \"left\" }} >\n\t\t\t\t\t\t\t\t{this.state.messages.length > 0 ? this.state.messages.map((item, index) => (\n\t\t\t\t\t\t\t\t\t<div key={index} style={{textAlign: \"left\"}}>\n\t\t\t\t\t\t\t\t\t\t<p style={{ wordBreak: \"break-all\" }}><b>{item.sender}</b>: {item.data}</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)) : <p>No message yet</p>}\n\t\t\t\t\t\t\t</Modal.Body>\n\t\t\t\t\t\t\t<Modal.Footer className=\"div-send-msg\">\n\t\t\t\t\t\t\t\t<Input placeholder=\"Message\" value={this.state.message} onChange={e => this.handleMessage(e)} />\n\t\t\t\t\t\t\t\t<Button variant=\"contained\" color=\"primary\" onClick={this.sendMessage}>Send</Button>\n\t\t\t\t\t\t\t</Modal.Footer>\n\t\t\t\t\t\t</Modal>\n\n\t\t\t\t\t\t<div className=\"container\">\n\t\t\t\t\t\t\t<div style={{ paddingTop: \"20px\" }}>\n\t\t\t\t\t\t\t\t<Input value={window.location.href} disable=\"true\"></Input>\n\t\t\t\t\t\t\t\t<Button style={{backgroundColor: \"#3f51b5\",color: \"whitesmoke\",marginLeft: \"20px\",\n\t\t\t\t\t\t\t\t\tmarginTop: \"10px\",width: \"120px\",fontSize: \"10px\"\n\t\t\t\t\t\t\t\t}} onClick={this.copyUrl}>Copy invite link</Button>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<Row id=\"main\" className=\"flex-container\" style={{ margin: 0, padding: 0 }}>\n\t\t\t\t\t\t\t\t<video id=\"my-video\" ref={this.localVideoref} autoPlay muted style={{\n\t\t\t\t\t\t\t\t\tborderStyle: \"solid\",borderColor: \"#bdbdbd\",margin: \"10px\",objectFit: \"fill\",\n\t\t\t\t\t\t\t\t\twidth: \"100%\",height: \"100%\"}}></video>\n\t\t\t\t\t\t\t</Row>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t}\n\t\t\t</div>\n\t\t)\n\t}\n}\n\nexport default Video"]},"metadata":{},"sourceType":"module"}